<!DOCTYPE html>
<html>
<head>
  <title>Folio Test</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #content { width: 634px; } /* A4 width - 160px padding */
    .folio-pages { background: #f0f0f0; padding: 20px; }
    .folio-page { background: white; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>Folio Debug Test</h1>
  
  <div id="content">
    <h1>Test Document</h1>
    <p>This is paragraph 1. Lorem ipsum dolor sit amet.</p>
    <h2>Section 1</h2>
    <p>This is paragraph 2 under section 1.</p>
    <p>This is paragraph 3 with more content.</p>
    <h2>Section 2</h2>
    <p>Final paragraph here.</p>
  </div>

  <div id="output"></div>

  <script type="module">
    import { paginate, measureBlocks, resolveOptions } from '../dist/index.js';

    const content = document.getElementById('content');
    const output = document.getElementById('output');

    async function test() {
      console.log('Content element:', content);
      console.log('Children count:', content.children.length);

      const options = resolveOptions({ pageHeight: 1123, pageWidth: 794, padding: 80 });
      console.log('Options:', options);

      // Test measureBlocks directly
      const blocks = measureBlocks(content, options);
      console.log('Measured blocks:', blocks);
      console.log('Block count:', blocks.length);

      if (blocks.length === 0) {
        output.innerHTML = '<h2 style="color:red">ERROR: measureBlocks returned empty!</h2>';
        return;
      }

      // Test paginate
      const result = await paginate(content, { pageHeight: 1123, pageWidth: 794, padding: 80 });
      console.log('Pagination result:', result);
      console.log('Total pages:', result.totalPages);

      // Render result
      output.innerHTML = `
        <h2>Result: ${result.totalPages} pages</h2>
        <pre>${JSON.stringify(result.pages.map(p => ({
          index: p.index,
          fragmentCount: p.fragments.length,
          height: p.height
        })), null, 2)}</pre>
      `;
    }

    test().catch(err => {
      console.error('Error:', err);
      output.innerHTML = `<h2 style="color:red">ERROR: ${err.message}</h2><pre>${err.stack}</pre>`;
    });
  </script>
</body>
</html>
